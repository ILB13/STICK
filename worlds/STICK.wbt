#VRML_SIM R2025a utf8

WorldInfo {
  basicTimeStep 16
  gravity 9.81
  contactProperties [
    ContactProperties {
      material1 "cart_bottom"
      material2 "ground"
      coulombFriction 0.1     # slippery bottom
    }
    ContactProperties {
      material1 "cart_top"
      material2 "stick"
      coulombFriction 1.5     # sticky top
    }
  ]
}


# Camera
Viewpoint {
  orientation 0.0686910785537092 0.011791292255969388 -0.9975682939799473 2.8024036525619906
  position 1.8044496007954454 0.6762307107151491 0.538657350795988
}

# Directional light
DirectionalLight {
  direction -0.5 -1 -0.5
  intensity 1
  color 1 1 1
}

# Ground (no physics)
Solid {
  children [
    Shape {
      appearance Appearance { material Material { diffuseColor 0.4 0.4 0.4 } }
      geometry Plane { size 100 100}
    }
  ]
  boundingObject Plane { size 100 100}
}

# Cart robot
# Cart robot (Z is height)
Robot {
  name "Cart"
  translation 0 0 0.025  # Z = half cart height so it rests on the plane
  children [
    SliderJoint {
      jointParameters JointParameters { axis 1 0 0 }  # slides along X
      device [ LinearMotor { name "x motor" maxVelocity 5 } ]

      # Lower section (low friction)
      endPoint Solid {
        name "CartBottom"
        contactMaterial "cart_bottom"
        translation 0 0 0.0125
        children [
          Shape {
            geometry Box { size 0.2 0.2 0.025 }  # bottom layer
            appearance Appearance {
              material Material { diffuseColor 0.2 0.6 0.9 }
            }
          }

          # Upper section (high friction) fixed to the bottom
          FixedJoint {
            endPoint Solid {
              name "CartTop"
              contactMaterial "cart_top"
              translation 0 0 0.025  # sits right above bottom
              children [
                Shape {
                  geometry Box { size 0.2 0.2 0.025 }  # top layer
                  appearance Appearance {
                    material Material { diffuseColor 0.2 0.6 0.9 }
                  }
                }
              ]
              boundingObject Box { size 0.2 0.2 0.025 }
              physics Physics { mass 0.5 }
            }
          }
        ]

        # The bottom layer carries the physics for the whole cart
        boundingObject Box { size 0.2 0.2 0.025 }
        physics Physics { mass 0.5 }
      }
    }
  ]
  controller "cart_controller"
}

Solid {
  name "Stick"
  translation 0 0 0.33
  rotation 1 0 0 0.0002  # small tilt
  children [
    Shape {
      geometry Cylinder { radius 0.02 height 0.46 }
      appearance Appearance { material Material { diffuseColor 0.7 0.7 0.7 } }
    }
    Transform {
      translation 0 0 0.23
      children [ Shape { geometry Sphere { radius 0.02 }
                         appearance Appearance { material Material { diffuseColor 0.7 0.7 0.7 } } } ]
    }
    Transform {
      translation 0 0 -0.23
      children [ Shape { geometry Sphere { radius 0.02 }
                         appearance Appearance { material Material { diffuseColor 0.7 0.7 0.7 } } } ]
    }
  ]
  boundingObject Group {
    children [
      Cylinder { radius 0.02 height 0.46 }
      Transform { translation 0 0 0.23 children [ Sphere { radius 0.02 } ] }
      Transform { translation 0 0 -0.23 children [ Sphere { radius 0.02 } ] }
    ]
  }
  physics Physics { mass 1.2 friction 1}   # one physics block here only
}
