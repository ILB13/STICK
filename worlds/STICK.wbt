#VRML_SIM R2025a utf8

WorldInfo {
  basicTimeStep 16
  gravity 9.81
  contactProperties [
    ContactProperties {
      material1 "cart_bottom"
      material2 "ground"
      coulombFriction 0.1     # slippery bottom
    }
    ContactProperties {
      material1 "cart_top"
      material2 "stick"
      coulombFriction 1.5     # sticky top
    }
  ]
}


# Camera
Viewpoint {
  orientation 0.013748294993807449 0.01360065943500682 -0.9998129857366806 1.581779674252382
  position 0.0624620365351748 1.9282260565193057 0.33249020966341003
}

# Directional light
DirectionalLight {
  direction -0.5 -1 -0.5
  intensity 1
  color 1 1 1
}

# Ground (no physics)
Solid {
  children [
    Shape {
      appearance Appearance { material Material { diffuseColor 0.4 0.4 0.4 } }
      geometry Plane { size 100 100}
    }
  ]
  boundingObject Plane { size 100 100}
}

# --- Cart robot ---
# --- Cart robot ---
Robot {
  name "Cart"
  translation 0 0 0.025  # Z = half cart height
  children [
    # Cart slides along X
    SliderJoint {
      jointParameters JointParameters { axis 1 0 0 }
      device [ LinearMotor { name "x motor" maxVelocity 10 } ]
      
      # Moving part of the slider: the cart body
      endPoint Solid {
        name "CartBody"
        translation 0 0 0.025
        children [
          # Cart box shape
          Shape {
            geometry Box { size 0.2 0.2 0.05 }
            appearance Appearance {
              material Material { diffuseColor 0.2 0.6 0.9 }
            }
          }

          # Stick hinge joint (attached to top of cart)
          HingeJoint {
            jointParameters HingeJointParameters {
              anchor 0 0 0.05     # top center of the cart
              axis 0 1 0          # rotate around Y-axis
            }
            device [
              PositionSensor { name "stick_angle_sensor" }
            ]

            endPoint Solid {
              name "Stick"
              translation 0 0 0.25   # center so bottom hemisphere meets hinge
              children [
                # Main stick cylinder
                Shape {
                  geometry Cylinder { radius 0.02 height 0.46 }
                  appearance Appearance {
                    material Material { diffuseColor 0.7 0.7 0.7 }
                  }
                }

                # Top hemisphere
                Transform {
                  translation 0 0 0.23
                  children [
                    Shape {
                      geometry Sphere { radius 0.02 }
                      appearance Appearance {
                        material Material { diffuseColor 0.7 0.7 0.7 }
                      }
                    }
                  ]
                }

                # Bottom hemisphere
                Transform {
                  translation 0 0 -0.23
                  children [
                    Shape {
                      geometry Sphere { radius 0.02 }
                      appearance Appearance {
                        material Material { diffuseColor 0.7 0.7 0.7 }
                      }
                    }
                  ]
                }
              ]

              # Combined collision shape
              boundingObject Group {
                children [
                  Cylinder { radius 0.02 height 0.46 }
                  Transform { translation 0 0 0.23 children [ Sphere { radius 0.02 } ] }
                  Transform { translation 0 0 -0.23 children [ Sphere { radius 0.02 } ] }
                ]
              }

              physics Physics { mass 1.2 }
            }
          }
        ]
        boundingObject Box { size 0.2 0.2 0.05 }
        physics Physics { mass 1.0 }
      }
    }
  ]
  controller "cart_controller"
}